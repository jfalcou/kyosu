//======================================================================================================================
/*
  Kyosu - Complex Without Complexes
  Copyright : KYOSU Contributors & Maintainers
  SPDX-License-Identifier: BSL-1.0
*/
//======================================================================================================================
#include <kyosu/kyosu.hpp>
#include <test.hpp>

TTS_CASE_TPL ( "Check kyosu::cyl_bessel_kn integral  order"
              , kyosu::scalar_real_types
              )
<typename T>(tts::type<T>)
{
  auto constexpr N = 11;
  using a_t  = std::array<T, 16 >;
  using aN_t = std::array<a_t, N >;
  a_t re{-5.2999999999999998e+00, -4.5999999999999996e+00, -3.8999999999999999e+00, -3.2000000000000002e+00, -2.5000000000000000e+00, -1.7999999999999998e+00, -1.1000000000000005e+00, -4.0000000000000036e-01, 2.9999999999999982e-01, 1.0000000000000000e+00, 1.7000000000000002e+00, 2.3999999999999995e+00, 3.0999999999999988e+00, 3.7999999999999998e+00, 4.4999999999999991e+00, 5.2000000000000002e+00};
  a_t im{8.0000000000000000e+00, -7.0000000000000000e+00, 6.0000000000000000e+00, -5.0000000000000000e+00, 4.0000000000000000e+00, -3.0000000000000000e+00, 2.0000000000000000e+00, -1.0000000000000000e+00, -0.0000000000000000e+00, 1.0000000000000000e+00, -2.0000000000000000e+00, 3.0000000000000000e+00, -4.0000000000000000e+00, 5.0000000000000000e+00, -6.0000000000000000e+00, 7.0000000000000000e+00};
  aN_t reresN16;
  aN_t imresN16;
  //res are taken from octave 9.2.0 besselj outputs
  int i=0;
  reresN16[i] = a_t{-7.6426863392141115e+01,-9.0002239400280288e+00,1.6688121409598665e+01,1.2406923086087012e+01,2.2888684274756770e+00,-2.6219327973230624e+00,-2.4999100901074733e+00,-5.2493653524130623e-01,1.3724600605442980e+00,8.0197726946517736e-02,-1.0143807229843078e-01,-5.4541055012629798e-02,-6.6883612791388694e-03,7.3999114785972863e-03,4.9614711732347619e-03,9.0129863623049551e-04,};
  imresN16[i] = a_t{-2.8619908354383703e+01,4.2472451857378672e+01,-1.6333205050745224e+01,-2.9368613253804234e+00,6.7379123108606311e+00,-3.1685626174100103e+00,-4.0163985317199308e-01,1.7212964277105582e+00,0.0000000000000000e+00,-3.5727745928533017e-01,9.2179460261976223e-02,1.5955542061226579e-02,-2.3792687755670724e-02,8.2085162874102127e-03,8.4212686907880188e-04,-2.1389224461818642e-03,};
  ++i; //1  2  1.000e+00
  reresN16[i] = a_t{-7.5558723336697170e+01,-1.0901783756590387e+01,1.5082490243488515e+01,1.2087694612551193e+01,2.8064705166867476e+00,-2.0364309730027270e+00,-2.3702856960439487e+00,-1.2321752235513028e+00,3.0559920334573265e+00,2.4568305523740397e-02,-1.2596578001410641e-01,-5.7496621196871787e-02,-5.3406902773497460e-03,8.2569869882903046e-03,5.1186584912694512e-03,8.3716066698756391e-04,};
  imresN16[i] = a_t{-2.4400320472609398e+01,4.0656258546036412e+01,-1.6748029094651155e+01,-1.8906987893469371e+00,6.1679526686719459e+00,-3.3016711308793130e+00,1.4576006614871148e-01,1.3476064107535497e+00,0.0000000000000000e+00,-4.5971947380118922e-01,9.0250054265010926e-02,2.2411626032691864e-02,-2.5739594203717093e-02,8.1597667029847352e-03,1.1307863283709636e-03,-2.2528858999184358e-03,};
  ++i; //2  2  2.000e+00
  reresN16[i] = a_t{-7.1969079270007995e+01,-1.5683393966879203e+01,1.0466294168141445e+01,1.0748175707345291e+01,3.8758917427989048e+00,-4.0451627051867489e-01,-1.3871137761167767e+00,-1.9986198478844575e+00,2.1745740283593154e+01,-3.5495344133093099e-01,-2.1599306055793810e-01,-6.4128726120274343e-02,5.9177725553375728e-05,1.1059920812797431e-02,5.5392221151187348e-03,6.0101021352945098e-04,};
  imresN16[i] = a_t{-1.2683509501122607e+01,3.4965859052136359e+01,-1.7316514091627536e+01,8.3661819724535313e-01,4.3427874804402400e+00,-3.1957333499958636e+00,1.3566078701770719e+00,-1.3325273444493084e+00,0.0000000000000000e+00,-8.4156523861025967e-01,6.3585420268451043e-02,4.6616485973025479e-02,-3.1692375622982084e-02,7.6873285860862006e-03,2.1150331597556389e-03,-2.6011826078990870e-03,};
  ++i; //3  2  3.000e+00
  reresN16[i] = a_t{-6.3398095945142771e+01,-2.0743140718808760e+01,3.7786330432919257e+00,7.7088917465203517e+00,4.1874000564195475e+00,1.3345916861218499e+00,8.8425625718645262e-01,6.1194636854248738e+00,2.9299919581469953e+02,-2.3684690543586404e+00,-4.1296667608690574e-01,-6.1306779671013244e-02,1.4487963130091701e-02,1.6417670763042964e-02,5.9887954199450404e-03,4.3734830851821721e-05,};
  imresN16[i] = a_t{3.5278035154898033e+00,2.5227141704076221e+01,-1.6378051359951002e+01,3.9054079422695622e+00,1.4289799635400391e+00,-1.8184125627627998e+00,1.1299895441055428e+00,-3.7062174171938067e+00,0.0000000000000000e+00,-1.4329430683598463e+00,-9.7785305188985844e-02,1.0486846741374450e-01,-4.1047622868930829e-02,5.5139497215588133e-03,4.1709983752767615e-03,-3.1857223573503878e-03,};
  ++i; //4  2  4.000e+00
  reresN16[i] = a_t{-4.8238011620979321e+01,-2.2625088204793681e+01,-2.7738906038028466e+00,3.2234038628141422e+00,2.5942970586940834e+00,1.0920389516720443e+00,9.5378206961135137e-02,4.5105108918941026e+00,5.8817296565775869e+03,-1.1759189809486388e+01,-6.5704334122827301e-01,3.9481564125719015e-03,4.9048598384438417e-02,2.4745047208440028e-02,5.7444049565152262e-03,-1.1406496008595471e-03,};
  imresN16[i] = a_t{1.9143230140252971e+01,1.2624339365385053e+01,-1.2489027033155670e+01,5.2714343125698431e+00,-1.1373159266235695e+00,3.7138315556227008e-01,-2.1115314920751378e+00,3.7987907064011360e+01,0.0000000000000000e+00,1.9650127193861220e+00,-8.0042186942248139e-01,2.2369155134132895e-01,-4.7927231938480426e-02,-1.6131802688769854e-03,7.9499414486533110e-03,-3.9324740393181894e-03,};
  ++i; //5  2  5.000e+00
  reresN16[i] = a_t{-2.7884376521690569e+01,-1.8952373308962059e+01,-6.2375339309869933e+00,-6.1620789567135792e-01,2.1975732267411335e-01,-6.7836228753598726e-01,-5.7613928972204915e+00,-2.6830889094056818e+02,1.5713912337121708e+05,-4.1545177414759699e+01,1.4885632392110426e-01,3.0755513329059081e-01,1.2187088628376008e-01,3.3854846837624547e-02,2.8812645559306255e-03,-3.4763804978906248e-03,};
  imresN16[i] = a_t{2.8237976018432040e+01,5.4668805363983630e-01,-6.1690220215992424e+00,3.7347903517694974e+00,-1.2798374452572332e+00,-1.1408107583204891e-01,4.4035837511848239e+00,-7.7393472132438291e+01,0.0000000000000000e+00,5.3463867047130186e+01,-3.2035082201088860e+00,3.8942958068283601e-01,-2.6172191544146940e-02,-2.0825871995263232e-02,1.4160853131974540e-02,-4.4970656291481517e-03,};
  ++i; //6  2  6.000e+00
  reresN16[i] = a_t{-7.6591210017572227e+00,-1.0744515108193536e+01,-5.2514828316384596e+00,-1.5161212486214848e+00,4.6547356350616520e-02,2.3692410309701857e+00,2.9163899683568022e+01,1.5968986876907352e+03,5.2438525086971503e+06,4.7834258352366064e+01,9.0092443088205627e+00,1.2955613420127927e+00,2.3744708087418620e-01,3.0961846905868309e-02,-7.0554934061797820e-03,-7.6578297682804164e-03,};
  imresN16[i] = a_t{2.7115185757131535e+01,-6.6432458982235154e+00,-4.8270220008419867e-01,1.0057224499083264e+00,-9.4365669344185887e-02,-1.1235032219788039e+00,1.0707746181893524e+01,-2.0081457316221331e+03,0.0000000000000000e+00,4.7701023502883544e+02,-8.2724847523584728e+00,2.3179832218620294e-01,1.1074115984136534e-01,-6.4598106174080586e-02,2.2351972813892274e-02,-3.8075500238442307e-03,};
  ++i; //7  2  7.000e+00
  reresN16[i] = a_t{5.6716874200662639e+00,-2.5451627983711442e+00,-2.1169551745992243e+00,-6.7648857238630078e-01,-4.6578534361364887e-02,-1.5549546304868915e+00,-3.0325225422681811e+01,1.3897755831947412e+04,2.0991123947125733e+08,3.1075217828724490e+03,5.5639163719645744e+01,3.4008414645014131e+00,2.5921784981887086e-01,-2.8620461264232462e-02,-3.2502534315784079e-02,-1.3966685331446821e-02,};
  imresN16[i] = a_t{1.7495765159653970e+01,-7.0905995105893416e+00,1.6555674500256292e+00,5.7519721980369420e-02,-1.2530196036619081e+00,8.8369276422781535e+00,-1.5706970646121960e+02,2.4751816669311582e+04,0.0000000000000000e+00,2.6285197271059460e+03,3.6851963464485360e+00,-2.3181867223996777e+00,5.7972515433870087e-01,-1.4261553872675850e-01,2.6587715473400997e-02,8.3784466869081357e-04,};
  ++i; //8  2  8.000e+00
  reresN16[i] = a_t{9.0493868852264683e+00,1.4958958988312283e+00,-2.7875449078178116e-01,-7.7036904929457217e-01,-3.0338503561176573e+00,-2.4752172718001454e+01,-7.2533577582599958e+02,-3.6422453754443646e+05,9.8011016945007114e+09,4.0200124828201122e+04,1.8622645749126028e+02,2.4408479860819652e+00,-5.9092285121594534e-01,-2.6076473144429047e-01,-8.3162653613470083e-02,-1.9949596135950438e-02,};
  imresN16[i] = a_t{6.1203462968888784e+00,-3.6898728332066764e+00,1.2245864524238168e+00,-4.1116414520409161e-01,1.9939077712132627e+00,-2.4652806413633950e+01,6.3795914567092848e+02,4.6231861422790585e+04,0.0000000000000000e+00,-2.8760041553366837e+03,2.3056703008008793e+02,-1.4722565863565054e+01,1.6599903315772653e+00,-2.0617301418035033e-01,3.5930962325304884e-03,1.4994794194494529e-02,};
  ++i; //9  2  9.000e+00
  reresN16[i] = a_t{5.8456076951729186e+00,1.7759292649864591e+00,5.1836174899908793e-01,1.3761796154743529e+00,1.1142819739901789e+01,1.5336312397513990e+02,6.3383124551929241e+03,1.3857315985213832e+06,5.2293533494617615e+11,3.0170048716578790e+05,-2.8003359662876284e+02,-3.8127247884114801e+01,-5.0336034950173616e+00,-8.4881155675715547e-01,-1.4508294851121112e-01,-1.3708787497776240e-02,};
  imresN16[i] = a_t{-7.1823079305712434e-01,-8.3183410019725146e-01,6.8595675843814274e-01,-1.0939535955314421e+00,3.8890078993942505e+00,-3.0223813023686880e+01,2.1428657758081922e+03,-5.2541072469658973e+06,0.0000000000000000e+00,-3.4198051214119641e+05,1.7788187025726777e+03,-4.8558514127063120e+01,2.3179702917229976e+00,6.8486369320349488e-02,-1.1074405018261560e-01,4.6628502798732804e-02,};
  ++i; //10  2  1.000e+01
  reresN16[i] = a_t{1.8705812785403750e+00,8.9390264746256931e-01,4.5731922785878609e-01,-2.2587762629493821e-01,-1.2985235503946626e+01,-2.9737303166534144e+02,-1.0006606156579363e+04,7.2563933165931553e+07,3.1385921198465086e+13,-3.2232009995047527e+05,-1.0351727294244087e+04,-2.8680419750546065e+02,-1.8075067170857675e+01,-1.5765592862961662e+00,-7.9453523118992064e-02,4.0440315000931162e-02,};
  imresN16[i] = a_t{-2.2763123028206493e+00,4.8120685443052869e-01,-8.0894671168981580e-01,4.8915569812233448e+00,-4.1929165340951684e+01,7.3195342206880173e+02,-5.1302154241651042e+04,5.4160663716198117e+07,0.0000000000000000e+00,-5.7960049979181942e+06,6.6675253493962655e+03,-1.7355114952110256e+01,-7.4410135482785300e+00,1.8495447284579840e+00,-4.3443759717196123e-01,9.5107038890459739e-02,};
  auto pr2 = tts::prec<T>()*2;
  using eve::spherical;
  using kyosu::kind_1;
  auto h =  eve::half(eve::as<T>());
  for(int j=0; j <= 15; ++j)
  {
    auto c = kyosu::complex(re[j], im[j]);
   auto fac = kyosu::sqrt(eve::pio_2(eve::as(kyosu::real(c)))*kyosu::rec(c));
    for(int i=0; i < N; ++i)
    {
      // std::cout<< "j " << j  << " c[" << i << "] = " << c << std::endl;
      auto res = kyosu::complex(reresN16[i][j], imresN16[i][j]);
      if( ((i < 7) || (sizeof(T) == 8 ) || kyosu::is_not_real(c)) ) // The limitation of these tests with float is due to some overflow pbs when z is real
      {
        TTS_RELATIVE_EQUAL(kyosu::bessel_k(i, c), res, pr2);
        TTS_RELATIVE_EQUAL(kyosu::bessel_k(-i, c), res, pr2);
        TTS_RELATIVE_EQUAL(kyosu::bessel_k[spherical](i, c), kyosu::bessel_k(i+h, c)*fac, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_k[spherical](-i, c), kyosu::bessel_k(-i+h, c)*fac, tts::prec<T>());
      }
    }
  }
};
