//======================================================================================================================
/*
  Kyosu - Complex Without Complexes
  Copyright : KYOSU Contributors & Maintainers
  SPDX-License-Identifier: BSL-1.0
*/
//======================================================================================================================
#include <kyosu/kyosu.hpp>
#include <test.hpp>

TTS_CASE_WITH ( "Check kyosu::cyl_bessel_h1n over real"
              , kyosu::scalar_real_types
              , tts::generate(tts::randoms(-10,10))
              )
<typename T>(T )
{
  auto constexpr N = 11;
  using a_t  = std::array<T, 16 >;
  using aN_t = std::array<a_t, N >;
  a_t re{-5.2999999999999998e+00, -4.5999999999999996e+00, -3.8999999999999999e+00, -3.2000000000000002e+00, -2.5000000000000000e+00, -1.7999999999999998e+00, -1.1000000000000005e+00, -4.0000000000000036e-01, 2.9999999999999982e-01, 1.0000000000000000e+00, 1.7000000000000002e+00, 2.3999999999999995e+00, 3.0999999999999988e+00, 3.7999999999999998e+00, 4.4999999999999991e+00, 5.2000000000000002e+00};
  a_t im{8.0000000000000000e+00, -7.0000000000000000e+00, 6.0000000000000000e+00, -5.0000000000000000e+00, 4.0000000000000000e+00, -3.0000000000000000e+00, 2.0000000000000000e+00, -1.0000000000000000e+00, -0.0000000000000000e+00, 1.0000000000000000e+00, -2.0000000000000000e+00, 3.0000000000000000e+00, -4.0000000000000000e+00, 5.0000000000000000e+00, -6.0000000000000000e+00, 7.0000000000000000e+00};
  aN_t reresN16;
  aN_t imresN16;
  //res are taken from octave 9.2.0 besselj outputs
  int i=0;
  reresN16[i] = a_t{5.4897235878702522e-05,-1.2268421138042991e+02,6.2791919542924018e-04,-4.8089232666858855e+01,-2.4084160260729008e-03,6.1781027538348077e-01,-6.6559203024245964e-02,2.5605247393843049e+00,9.7762624653829611e-01,2.2744989480229472e-01,9.8407508041674696e-01,8.0887252704128568e-03,-1.8273514210562674e+01,-1.7457419869508024e-03,-6.1802005844609923e+01,-1.6987525206133878e-04,};
  imresN16[i] = a_t{-6.5539561898233831e-05,2.8056814033312583e+02,3.7023665194116904e-04,-1.1742199634170285e+01,6.1311336939828889e-03,-8.8084554422437513e+00,-1.6219886131682522e-02,-6.6297629083583021e-01,-8.0727357780451992e-01,-5.1055458673089568e-02,3.6321658845974136e+00,1.8052231450423499e-02,7.4948386100868873e+00,1.1896731293522277e-03,-1.0185845035564768e+02,-1.7463870535747248e-04,};
  ++i; //1   1.000e+00
  reresN16[i] = a_t{-6.9868644506618311e-05,2.7064676972685243e+02,3.6886164009504170e-04,-8.5309491355821621e+00,6.7926396008222457e-03,-7.7947066285489113e+00,-1.3037972953166450e-02,-2.6465006046269030e-01,1.4831881627310406e-01,-1.5640669069980788e-02,3.2658114168417036e+00,2.0448522418679817e-02,5.6969763924510062e+00,1.1844646693963893e-03,-9.9003239995999664e+01,-1.8815491376888570e-04,};
  imresN16[i] = a_t{-5.5439750416853029e-05,1.0676239189527861e+02,-6.7744869054317850e-04,4.5195192232412410e+01,2.2998038589222207e-03,2.9120943115132863e-01,8.0073592652737891e-02,-8.4023335956971990e-01,-2.2931051383885306e+00,-2.9266650676425737e-01,-3.2109920594551683e-01,-7.5444920068123474e-03,1.7334275515362012e+01,1.9088885170084806e-03,5.4155975118041177e+01,1.7188222826493554e-04,};
  ++i; //2   2.000e+00
  reresN16[i] = a_t{-5.6487293158531979e-05,6.5890828141819014e+01,-8.4284801947258066e-04,3.6813584316790795e+01,1.7088759302197115e-03,1.5320007765665287e+00,1.3354152761309773e-01,-9.2932925015189749e-01,1.1165861949063943e-02,-5.3575707063653277e-01,8.1391557866073649e-01,-4.5056659500341961e-03,1.4237866007138228e+01,2.4579837886114860e-03,3.4408212753401202e+01,1.7578714175771814e-04,};
  imresN16[i] = a_t{8.4060135972775416e-05,-2.4056185796796944e+02,-3.5348679634467821e-04,1.1134050358938667e+00,-9.0902409344857694e-03,4.9018709877144806e+00,-7.5824194390195195e-03,7.8615436560341267e-01,-1.4480094011452358e+01,-2.2597037902118694e-01,-1.8946465279715725e+00,-2.8818132273240451e-02,-1.5187230562074436e+00,-1.1221552278486639e-03,8.9402715175387669e+01,2.3278894163732160e-04,};
  ++i; //3   3.000e+00
  reresN16[i] = a_t{1.1208229382890835e-04,-1.9192184405276925e+02,-2.7777111106750833e-04,-5.4725122711374690e+00,-1.4097476196506266e-02,2.0877738308485188e+00,-1.1138469058038176e-01,-1.1643936138223201e+00,5.5934304776041695e-04,-1.5078142302454585e+00,-2.6264767828356361e-01,-4.6808412689629257e-02,2.1456283474097195e+00,-8.0621291914483473e-04,7.1868709602255961e+01,3.2195900259589173e-04,};
  imresN16[i] = a_t{5.5716854320101858e-05,-1.7376967514127351e+01,1.1801385263236690e-03,-2.4706540079280316e+01,5.5684308316057988e-04,-1.6727014076828581e+00,-2.7872418293548179e-01,-3.4487011107518746e+00,-1.9077481501430970e+02,9.1223988999494887e-01,-6.0375881450742841e-01,-7.5358656099016067e-03,-9.1744281816158395e+00,-3.5878042177064882e-03,-1.0866268820465949e+01,-1.7293470042642709e-04,};
  ++i; //4   4.000e+00
  reresN16[i] = a_t{4.6824920084426248e-05,2.0011046593782176e+01,1.7993961730877297e-03,-1.2799156451176460e+01,8.3956803369015457e-03,-9.1429914542866508e-01,-6.3441508565441440e-01,2.1176528679190525e+01,2.0999005910771326e-05,-1.2509659501149950e+00,-1.5120157929980915e-01,-5.0351158149484113e-02,-4.0818736752131617e+00,-5.6531100839384858e-03,7.0431799007798768e+00,-1.3920292998652033e-04,};
  imresN16[i] = a_t{-1.6172053418286162e-04,1.3250722360613375e+02,9.5016075623396965e-06,7.6888140727343410e+00,2.3921107562294385e-02,-3.5570234733472150e-01,6.1721694810288918e-01,3.2636372307812445e-01,-3.8010162062747440e+03,7.4861327397424073e+00,5.4339659366409299e-01,7.8549498372884330e-02,-3.1337284799199030e+00,-3.3868525362605421e-04,-4.8622550063767491e+01,-4.8157695797519608e-04,};
  ++i; //5   5.000e+00
  reresN16[i] = a_t{-2.4603267714178506e-04,7.5661709551704888e+01,-8.0961579456312728e-04,6.0430526298418910e+00,4.0954187893377701e-02,-3.1467219439377231e-01,3.0784334282780925e+00,-5.9504400832759345e+01,6.3044940002188614e-07,2.6448481388755098e+01,-1.2976842487270159e+00,1.0903373277629110e-01,-2.1827683625541732e+00,-3.8946480518686579e-03,-2.5869831744675270e+01,-7.5277372555815120e-04,};
  imresN16[i] = a_t{-1.3799645459747282e-05,-3.6152781907963863e+01,-2.8725319351140619e-03,4.5930355869688029e+00,-3.4133648567508321e-02,2.9843133507926495e-01,1.1845077198193978e+00,1.4859341276564339e+02,-1.0116965735231226e+05,3.4036154869434654e+01,1.3252346352671844e+00,1.9158587674452207e-01,1.0394643429264685e+00,9.0601260140378108e-03,-1.4241983038346410e+01,1.1989969067628880e-05,};
  ++i; //6   6.000e+00
  reresN16[i] = a_t{8.2784812261483496e-05,-3.3547875354058021e+01,-4.5484080871451742e-03,7.9491514858336609e-01,-1.1577548438340833e-01,6.4560302179385731e-01,-1.3181018653381145e+00,-1.0969666358562558e+03,1.5767594796476312e-08,3.0367414724106374e+02,-6.8974667710199240e+00,6.1704396905508363e-01,-1.8381913838457831e-01,1.3386621106526761e-02,-1.2547596722283924e+01,-3.6454425431502923e-04,};
  imresN16[i] = a_t{3.8339493293092778e-04,-3.3314697431879431e+01,3.1267157941802120e-03,-3.2854232467101374e+00,-5.9194199766671923e-02,-8.5442264149207103e-01,-1.4935499766447458e+01,-1.0256864149214980e+03,-3.3685208955374686e+06,3.0452234663655361e+01,-1.0404497395274004e+00,1.1358974430624866e-02,9.8271950407271658e-01,1.4005449734530460e-02,9.6344764387700668e+00,1.1827558004342605e-03,};
  ++i; //7   7.000e+00
  reresN16[i] = a_t{5.8853240025546420e-04,-9.3806761448936786e+00,9.3624186779720214e-03,-1.3154518041606473e+00,-1.2552257884299201e-02,1.6883805132636445e+00,-6.8539671388407811e+01,1.5209225807012073e+04,8.5048885023285613e-09,1.9783098100395591e+03,-1.5500215371033335e+01,1.1226593152107620e+00,7.3880891121265224e-02,4.0678545276246141e-02,1.4920090496570182e+00,1.7601898981938694e-03,};
  imresN16[i] = a_t{-3.3728363949529034e-04,2.2198246111197474e+01,6.4100262351886317e-03,3.4042529806727062e-01,3.6370889546205926e-01,3.1082057434180879e+00,4.2727784350280636e+01,-7.2523044805689824e+03,-1.3463966616414651e+08,-1.6733676303338843e+03,-2.8431820584590429e+01,-1.6744073145752145e+00,4.3466032280297238e-02,-1.3232254779175149e-02,7.4301566150422431e+00,1.3613093380018119e-03,};
  ++i; //8   8.000e+00
  reresN16[i] = a_t{-9.6718997810389825e-04,1.1151744009043766e+01,5.0806116399390155e-03,2.0118218290607925e-01,1.0509227730047923e+00,-1.4787092413771274e+01,4.3354245909937623e+02,1.5200930608871846e+04,-3.6068825022539437e-09,1.8309211106986577e+03,6.8898315905698965e+01,-2.8259704067974569e+00,2.1397661073781071e-01,1.7998794059650575e-02,3.1229463127700372e+00,3.8041831248133355e-03,};
  imresN16[i] = a_t{-8.2740821100739023e-04,-1.6411259891729366e-01,-2.5318291685430927e-02,2.3966048721356814e-01,-4.8133995302664601e-01,2.4863806820263143e-01,2.5698980300658104e+02,2.1959643330229673e+05,-6.2798159000979691e+09,-2.5592194317277754e+04,-1.6016177962218310e+02,-7.0175769289414118e+00,-7.4750842622204283e-01,-1.0405246098172488e-01,9.1536581756506086e-01,-2.1479752930232566e-03,};
  ++i; //9   9.000e+00
  reresN16[i] = a_t{-8.4795840596439426e-04,-2.0558653030379705e+00,-6.3015731861599519e-02,4.7909065938548479e-01,-3.2612755135268041e+00,3.2129726859521206e+01,1.8242190095876677e+02,-3.1279927505772938e+06,2.0307278554816495e-05,-1.9206849546267229e+05,1.0313508888898828e+03,-3.1296165833517691e+01,2.2085782721277067e+00,-2.2399168421415783e-01,9.4313790204425718e-01,-7.6157333893736286e-04,};
  imresN16[i] = a_t{2.4435333244852532e-03,-4.2239870420239409e+00,1.4916329627665193e-02,-2.3191344542392103e-01,-2.5212576303492895e+00,-6.1681834193193993e+01,-3.5737026834089879e+03,-9.9464621568559564e+05,-3.3478887500572778e+11,-2.1771155579347737e+05,-2.8385472466083957e+02,-7.3925557304838820e+00,-9.5646544084700669e-01,-1.8368187180451956e-01,-9.2865999476476913e-01,-9.3147556078417449e-03,};
  ++i; //10   1.000e+01
  reresN16[i] = a_t{5.6665496333854664e-03,-1.1396571449251707e+00,1.1276098133940345e-01,-3.9197139665327130e-01,-2.6137610326201903e+00,2.0186355452030639e+02,-2.5820346728141052e+04,3.4834091902578406e+07,-1.1554052326231523e-05,-3.6898513824160448e+06,5.9946876474935216e+03,-1.1581849933941487e+02,7.2871627616054351e+00,-8.2561541836632280e-01,1.8199456122050553e-02,-2.0176388163116819e-02,};
  imresN16[i] = a_t{-3.7801114719676209e-04,1.4569731875261576e+00,1.3776845183365691e-01,1.3629607897759746e+00,1.6133853676156892e+01,3.0477560035284563e+02,1.2063955436337446e+04,-4.2583748810418658e+07,-2.0081052684443582e+13,-2.0519534865996765e+05,4.2882717107417893e+03,9.9878996133077734e+01,4.8727276372307102e+00,2.9663388967962223e-01,-4.4181143810135504e-01,-8.0559027210203946e-03,};
  using kyosu::kind_1;
  using eve::spherical;
  auto h =  eve::half(eve::as<T>());
  for(int j=0; j <= 15; ++j)
  {
    auto c = kyosu::complex(re[j], im[j]);
    auto fac = kyosu::sqrt(eve::pio_2(eve::as(kyosu::real(c)))*kyosu::rec(c));
    for(int i=0; i < N; ++i)
    {
      // std::cout<< "j " << j  << " c[" << i << "] = " << c << std::endl;
      auto res = kyosu::complex(reresN16[i][j], imresN16[i][j]);
      if( ((i < 7) || (sizeof(T) == 8 ) || kyosu::is_not_real(c)) ) // The limitation of these tests with float is due to some overflow pbs when z is real
      {
        TTS_RELATIVE_EQUAL(kyosu::bessel_h[kind_1](i, c), res, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_h[kind_1](-i, c), eve::sign_alternate(i)*res, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_h[kind_1][spherical](i, c), kyosu::bessel_h[kind_1](i+h, c)*fac, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_h[kind_1][spherical](-i, c), kyosu::bessel_h[kind_1](-i+h, c)*fac, tts::prec<T>());
      }
    }
  }
};
