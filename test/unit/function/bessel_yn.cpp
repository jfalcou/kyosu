//======================================================================================================================
/*
  Kyosu - Complex Without Complexes
  Copyright : KYOSU Contributors & Maintainers
  SPDX-License-Identifier: BSL-1.0
*/
//======================================================================================================================
#include <kyosu/kyosu.hpp>
#include <test.hpp>

TTS_CASE_WITH ( "Check kyosu::cyl_bessel_yn over real"
              , kyosu::scalar_real_types
              , tts::generate(tts::randoms(-10,10))
              )
<typename T>(T )
{
  auto constexpr N = 11;
  using a_t  = std::array<T, 16 >;
  using aN_t = std::array<a_t, N >;
  a_t re{-5.2999999999999998e+00, -4.5999999999999996e+00, -3.8999999999999999e+00, -3.2000000000000002e+00, -2.5000000000000000e+00, -1.7999999999999998e+00, -1.1000000000000005e+00, -4.0000000000000036e-01, 2.9999999999999982e-01, 1.0000000000000000e+00, 1.7000000000000002e+00, 2.3999999999999995e+00, 3.0999999999999988e+00, 3.7999999999999998e+00, 4.4999999999999991e+00, 5.2000000000000002e+00};
  a_t im{8.0000000000000000e+00, -7.0000000000000000e+00, 6.0000000000000000e+00, -5.0000000000000000e+00, 4.0000000000000000e+00, -3.0000000000000000e+00, 2.0000000000000000e+00, -1.0000000000000000e+00, -0.0000000000000000e+00, 1.0000000000000000e+00, -2.0000000000000000e+00, 3.0000000000000000e+00, -4.0000000000000000e+00, 5.0000000000000000e+00, -6.0000000000000000e+00, 7.0000000000000000e+00};
  aN_t reresN16;
  aN_t imresN16;
  //res are taken from octave 9.2.0 besselj outputs
  int i=0;
  reresN16[i] = a_t{3.7228503917670645e+02,1.4028404905543897e+02,2.7082105569100559e+01,-5.8700747454210846e+00,-8.2705253054270944e+00,-4.3994205881197939e+00,-1.5033646224991988e+00,-4.4146240608696213e-01,-8.0727357780451992e-01,4.4547448893603253e-01,1.8303018031687566e+00,3.7536967330733093e+00,3.7504872004100616e+00,-7.5438037834143987e+00,-5.0929260867841691e+01,-1.4801145866706489e+02,};
  imresN16[i] = a_t{1.0994197036691477e+02,6.1342228067111975e+01,-5.4746691895180255e+01,2.4044970964177871e+01,-6.0660844500468452e+00,-3.1803969001486970e-01,1.5191915481134708e+00,-1.3499548225851350e+00,0.0000000000000000e+00,7.1015858200373461e-01,-4.6313696776094526e-01,-1.8893883861394067e+00,9.1358918130486799e+00,-2.2792749680635211e+01,3.0900648285609595e+01,2.3691500004012831e+01,};
  ++i; //1   1.000e+00
  reresN16[i] = a_t{-1.1635003995960993e+02,5.3381068215842468e+01,5.0388421789396631e+01,2.2597173117969191e+01,6.0352510091393095e+00,1.5549628647627789e-01,-8.1910523813119163e-01,-3.0904478519707901e-01,-2.2931051383885306e+00,-6.5769453559134528e-01,-1.9195398533045097e-01,2.0327376961863122e+00,8.6682428576348087e+00,2.0947914457155395e+01,2.7078359505548676e+01,-2.7914401072754870e+01,};
  imresN16[i] = a_t{3.5261743409642776e+02,-1.3532341084651281e+02,2.7699390907271528e+01,4.2665556883297704e+00,-7.1500338533314016e+00,3.9033361244587836e+00,-1.3658668861379402e+00,-9.9598522066041695e-03,0.0000000000000000e+00,6.2980100399288452e-01,-1.6135080104078159e+00,3.1826863536476275e+00,-2.8452340137284344e+00,-8.2421782961768049e+00,4.9501568913216829e+01,-1.4029142098186119e+02,};
  ++i; //2   2.000e+00
  reresN16[i] = a_t{-2.9762775424767278e+02,-1.2028088593877092e+02,-2.8266190690561899e+01,5.5544747986204690e-01,4.3434904347597794e+00,2.4402863252057978e+00,8.0059379319725266e-01,6.7176889968254105e-01,-1.4480094011452358e+01,-4.7336802053449323e-01,-9.8830057072931921e-01,-1.7988688832372615e+00,-7.6317842152824589e-01,9.4906183603062093e+00,4.4701463687243219e+01,1.1836404066466213e+02,};
  imresN16[i] = a_t{-1.3031491164249709e+02,-3.2945558528775152e+01,3.8720206627664581e+01,-1.8407463166947977e+01,5.5028557396442608e+00,-7.5377667674934246e-01,-3.1356235386620857e-01,8.2398784962920835e-01,0.0000000000000000e+00,5.7733695758049497e-01,-4.4451806514302838e-01,2.0980922018840360e+00,-7.1169346878646786e+00,1.5893162976210826e+01,-1.7203680564977855e+01,-3.7739753070724930e+01,};
  ++i; //3   3.000e+00
  reresN16[i] = a_t{1.3958417197710105e+02,-8.6883096628337686e+00,-2.3631195977314693e+01,-1.2352010359832823e+01,-4.0302717962534498e+00,-8.5196208880386270e-01,-3.3849774094703877e-01,-3.4588704199830058e+00,-1.9077481501430970e+02,8.6563240968334842e-01,-2.6730571856144153e-01,-1.4969677000121437e+00,-4.5914157362414194e+00,-9.2308592187965992e+00,-5.4336540845736305e+00,4.6394923953405495e+01,};
  imresN16[i] = a_t{-2.1919616943417924e+02,9.5961003073477983e+01,-2.6247460558083521e+01,2.7347064607671414e+00,1.5534314105179585e+00,-1.0675005055809359e+00,4.0136093823646224e-01,1.1898693688647326e+00,0.0000000000000000e+00,1.4716089522370916e+00,2.7277617257286835e-02,-3.5557851239194410e-01,-1.0774854268796867e+00,9.5546455890845188e+00,-3.5934122187452630e+01,8.6383214741966171e+01,};
  ++i; //4   4.000e+00
  reresN16[i] = a_t{1.3517588323331262e+02,6.6253451754166264e+01,2.0612634857290224e+01,3.8462950027082137e+00,4.9158140351805504e-02,-1.1870138570101160e-01,5.5265310681963831e-01,3.3001799236127277e-01,-3.8010162062747440e+03,7.4850921062958111e+00,5.4507129113365216e-01,-9.5219741642810662e-02,-1.5617213226723761e+00,-7.5591838399214906e+00,-2.4311779447868872e+01,-5.1614742314993137e+01,};
  imresN16[i] = a_t{1.3325114720668486e+02,-1.0005306503536854e+01,-1.0114199358723297e+01,6.4021659239935511e+00,-2.2028534047088271e+00,4.4280346284448741e-01,5.8476978169803417e-01,-2.1176495612709715e+01,0.0000000000000000e+00,1.2405926700807344e+00,1.9345797115021018e-02,-6.1942770176380624e-01,2.0316083852580307e+00,-3.3482416781625264e+00,-3.5222366991265335e+00,4.7557868456131473e+01,};
  ++i; //5   5.000e+00
  reresN16[i] = a_t{-1.0921588039131134e+02,-1.8076654139265070e+01,1.5926141228688171e+00,2.2909493771690208e+00,8.1793598691778358e-01,1.2336869385507715e-01,1.2008718613224181e+00,1.4859327328732920e+02,-1.0116965735231226e+05,3.4037106695822828e+01,1.2982834842475568e+00,3.6590510638929008e-01,5.4057008491256708e-01,8.5251452642874231e-03,-7.1202427788078033e+00,-3.9608136035998236e+01,};
  imresN16[i] = a_t{6.3901293025280964e+01,-3.7831177281524333e+01,1.3089025620419706e+01,-3.0197134853388330e+00,3.5596218961322207e-01,3.1380744007563366e-01,-3.0862791317214744e+00,5.9504035716963983e+01,0.0000000000000000e+00,-2.6449606697097394e+01,1.2766764464441240e+00,-2.9535225145884314e-01,1.0934481613147939e+00,-4.4689253410946908e+00,1.2933838904496884e+01,-2.2353323929042940e+01,};
  ++i; //6   6.000e+00
  reresN16[i] = a_t{-1.6807492498575112e+01,-1.6656694340926556e+01,-6.4898153604478370e+00,-1.6421152581698188e+00,-3.2825531286487081e-01,-8.3185904662418464e-01,-1.4935603799521378e+01,-1.0256864406811171e+03,-3.3685208955374686e+06,3.0452407887331368e+01,-1.0476416389818408e+00,8.9877940123682332e-02,5.0821668306666745e-01,1.9019244196706886e+00,4.8194903933592839e+00,3.9509370953072778e+00,};
  imresN16[i] = a_t{-7.5150355579309306e+01,1.6773669747572825e+01,-1.7199901856722817e+00,-4.0959213315093795e-01,3.3244917023503440e-01,-6.0191074272268130e-01,1.3214937926758361e+00,1.0969666594104988e+03,0.0000000000000000e+00,-3.0367415963468181e+02,6.8992564197937227e+00,-6.0452942741579663e-01,1.3628292271781095e-01,-9.6832577175665979e-01,6.2743821919957181e+00,-2.6382215139329229e+01,};
  ++i; //7   7.000e+00
  reresN16[i] = a_t{4.2482493349240350e+01,1.1099192178361823e+01,1.9200604621839970e+00,1.9579165298924586e-01,3.4184916172166696e-01,3.1149435729013701e+00,4.2727308787027354e+01,-7.2523044781637236e+03,-1.3463966616414651e+08,-1.6733676171799252e+03,-2.8432397201269172e+01,-1.6649955339913654e+00,-5.7786784653875614e-02,7.1734217805173184e-01,3.7157443506781922e+00,1.3706405407954035e+01,};
  imresN16[i] = a_t{5.5208146379537206e+00,4.6916548370566815e+00,-2.3926333798083590e+00,6.7015112503255825e-01,-9.6061968918266197e-02,-1.6982562665185039e+00,6.8539402572257359e+01,-1.5209225805840928e+04,0.0000000000000000e+00,-1.9783097984349813e+03,1.5501470379133199e+01,-1.1034318511175463e+00,5.7044830184723366e-02,4.5596589960521244e-01,-7.4148429668111138e-01,-3.6609967008880768e+00,};
  ++i; //8   8.000e+00
  reresN16[i] = a_t{-1.0707653196536389e+01,-8.4613388806288631e-02,5.1800311402822385e-01,6.2034531546739283e-02,-4.5125888577248902e-01,2.4608986007701389e-01,2.5698986804193680e+02,2.1959643330231027e+05,-6.2798159000979691e+09,-2.5592194317191672e+04,-1.6016167969714814e+02,-7.0199584068612717e+00,-7.3088192884264203e-01,-1.2504265383100771e-01,4.4942649577741806e-01,4.4531743856504074e+00,};
  imresN16[i] = a_t{1.9034776241150052e+01,-5.5767161846736117e+00,1.1215270674157036e+00,-5.3442903517943834e-02,-1.0417248621125190e+00,1.4786852571000775e+01,-4.3354250063519589e+02,-1.5200930609050894e+04,0.0000000000000000e+00,-1.8309211091507111e+03,-6.8898113692967399e+01,2.8304442126520981e+00,-1.6597110352999569e-01,3.1019781524996809e-01,-1.5559997072657976e+00,5.2124585664183032e+00,};
  ++i; //9   9.000e+00
  reresN16[i] = a_t{-6.1651912541866905e+00,-2.1080325703289331e+00,-4.4880086139223035e-01,-1.6459800184729217e-01,-2.5270193075329774e+00,-6.1681635678967986e+01,-3.5737026826573447e+03,-9.9464621568560554e+05,-3.3478887500572778e+11,-2.1771155579355906e+05,-2.8385469272434364e+02,-7.3936142638522711e+00,-9.4297826980435628e-01,-2.8090120779128114e-01,-4.8490560234946944e-01,-1.1564387019445224e+00,};
  imresN16[i] = a_t{-8.1657208828540107e+00,1.0234194452362728e+00,5.4973001885113740e-02,-4.5167668735214184e-01,3.2668288531402916e+00,-3.2129279743377396e+01,-1.8242189127907631e+02,3.1279927505772971e+06,0.0000000000000000e+00,1.9206849546276260e+05,-1.0313508815195476e+03,3.1296322182769426e+01,-2.2049796283501628e+00,2.7586573005195481e-01,-4.8317410915898185e-01,2.8051448010085016e+00,};
  ++i; //10  1.000e+01
  reresN16[i] = a_t{4.3258032510312585e+00,7.3447437403241755e-01,2.1316081241830720e-01,1.3605462507488568e+00,1.6133395796562827e+01,3.0477565051091506e+02,1.2063955435330176e+04,-4.2583748810418658e+07,-2.0081052684443582e+13,-2.0519534865997624e+05,4.2882717141439989e+03,9.9878851474011100e+01,4.8753702453646532e+00,2.6739237725271925e-01,-2.1999627357540907e-01,-1.2284823495501467e+00,};
  imresN16[i] = a_t{-9.3512033033284969e-01,5.8311250840495488e-01,-2.5038103542925777e-01,3.7134179753687346e-01,2.6119761767669547e+00,-2.0186362242221358e+02,2.5820346727696640e+04,-3.4834091902578406e+07,0.0000000000000000e+00,3.6898513824160453e+06,-5.9946876501059469e+03,1.1581835582418138e+02,-7.2894095558941636e+00,8.0923232259914468e-01,-7.0789766434117996e-02,1.5672646539923257e-01,};
  using eve::spherical;
  auto h =  eve::half(eve::as<T>());
  for(int j=0; j <= 15; ++j)
  {
    auto c = kyosu::complex(re[j], im[j]);
    auto fac = kyosu::sqrt(eve::pio_2(eve::as(kyosu::real(c)))*kyosu::rec(c));
    for(int i=0; i < N; ++i)
    {
//      std::cout<< "i " << i  << "j " << j  << " c[" << i << "] = " << c << std::endl;
      auto res = kyosu::complex(reresN16[i][j], imresN16[i][j]);
      if( ((i < 7) || (sizeof(T) == 8 ) || kyosu::is_not_real(c)) ) // The limitation of these tests with float is due to some overflow pbs when z is real
      {
        TTS_RELATIVE_EQUAL(kyosu::bessel_y(i, c), res, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_y[spherical](i, c), kyosu::bessel_y(i+h, c)*fac, tts::prec<T>());
        TTS_RELATIVE_EQUAL(kyosu::bessel_y(-i, c), eve::sign_alternate(i)*res, tts::prec<T>());
      }
      TTS_RELATIVE_EQUAL(kyosu::bessel_y[spherical](-i, c), kyosu::bessel_y(-i+h, c)*fac, tts::prec<T>());
    }
  }
};
